---
title: "Crypto exploratory visualization"
author: "Ranjit"
date: '2022-05-31'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(tidyverse)
library(viridis)
load("data/df.Rdata")
```

# English labels
```{r}

df_ipst_relabeled <- df_ipst %>%
  mutate(
    krybws01 = krybws01 %>% as.numeric %>% recode_factor(
      `1` = "Has heard of crypto currency",
      `2` = "Has not heard of crypto currency"),
    krybst01 = krybst01 %>% as.numeric %>% recode_factor(
      `1` = "Currently holds crypto currency",
      `2` = "Previously held crypto currency",
      `3` = "Never held crypto currency"
    ),
    krybsz01 = krybsz01 %>% as.numeric %>%  recode_factor(
      `1` = "Wants to hold crypto currency in the future",
      `2` = "Does not want to hold crypto currency in the future",
      `3` = "Uncertain"
    )
  )

```


```{r}

df_long <- df_ipst_relabeled %>% 
  mutate(across(contains("kryb"), na_if, -77)) %>% 
  pivot_longer(cols = pvq_STR:pvq_OCH, names_to = "value_dim", values_to = "value_score") %>% 
  mutate(value_dim = factor(value_dim,
                            levels = c("pvq_STR", "pvq_SEN", "pvq_OCH", "pvq_CON"),
                            labels = c(
                              "Self-Transcendence",
                              "Self-Enhancement",
                              "Openness to Change",
                              "Conservation"
                            ))) 

df_long_z <- df_ipst_relabeled %>% 
  mutate(across(contains("kryb"), na_if, -77)) %>% 
  mutate(across(pvq_STR:pvq_OCH, scale)) %>% 
  pivot_longer(cols = pvq_STR:pvq_OCH, names_to = "value_dim", values_to = "value_score") %>% 
  mutate(value_dim = factor(value_dim,
                            levels = c("pvq_STR", "pvq_SEN", "pvq_OCH", "pvq_CON"),
                            labels = c(
                              "Self-Transcendence",
                              "Self-Enhancement",
                              "Openness to Change",
                              "Conservation"
                            ))) 

# Plotting function

plot_values <- function(data, target_var){
  data %>% 
    mutate(crypto_var = get(target_var)) %>% 
    drop_na(crypto_var) %>%
    group_by(value_dim, crypto_var) %>% 
    mutate(value_median = median(value_score),
           value_mean = mean(value_score)) %>% 
    ggplot(aes(value_score, color = crypto_var), stat = "unique")+
    facet_grid(rows = vars(value_dim), switch = "both", scales = "free_y")+
    #geom_vline(xintercept = 0)+
    geom_hline(yintercept = 0, color = "grey")+
    geom_vline(xintercept = 0)+
    geom_density(size = 1)+
    #geom_point(aes(value_mean, color=crypto_var, y =0), stat = "unique", size = 3, shape = 17)+
    geom_text(aes(value_median, color=crypto_var, y =0), stat = "unique", size = 8, label = "|")+
    #geom_vline(aes(xintercept = value_median, color = crypto_var, linetype = "median"),               size = 1)+
    #geom_vline(aes(xintercept = value_mean, color = crypto_var, linetype = "mean"),       size = 1)+
    #scale_color_viridis("", option = "turbo", discrete = T, begin = 0.2, end = 0.8)+
    theme_minimal(base_size = 16)+
    xlab("Value Scores")+
    theme(
      legend.position = "bottom",
      legend.direction = "vertical",
      axis.text.y = element_blank(),
      axis.title.y = element_blank(),
      strip.text.y.left = element_text(angle = 0, hjust = 1),
      panel.grid.major.y = element_blank(),
      panel.grid.minor.y = element_blank()
    ) 
}



```

# Value distributions

Median: "\|"

### Crypto awareness {.tabset}

#### raw values

All participants

```{r fig.height=5}
df_long %>% 
plot_values("krybws01")
```

#### z-scores

All participants

```{r fig.height=5}
df_long_z %>% 
plot_values("krybws01")
```

### Crypto posession (current / past) {.tabset}

#### raw values

Only those with awareness

```{r fig.height=5}

df_long %>% 
  filter(krybws01 == "Has heard of crypto currency")%>% 
  plot_values("krybst01")



```

#### z-scores

Only those with awareness

```{r fig.height=5}

df_long_z %>% 
  filter(krybws01 == "Has heard of crypto currency")%>% 
  plot_values("krybst01")



```

### Crypto posession (future) I {.tabset}

#### raw values

*N* = 692; Only those with awareness

```{r fig.height=5}
df_long %>% 
  filter(krybws01 == "Has heard of crypto currency")%>% 
plot_values("krybsz01")

```

#### z-scores

*N* = 692; Only those with awareness

```{r fig.height=5}
df_long_z %>% 
  filter(krybws01 == "Has heard of crypto currency")%>% 
plot_values("krybsz01")

```

### Crypto posession (future) II {.tabset}

#### raw values

*N* = 576; Only with awareness but no previous holding

```{r fig.height=5}
df_long %>% 
  filter(krybws01 == "Has heard of crypto currency",
         krybst01 == "Never held crypto currency")%>% 
plot_values("krybsz01")

```


#### z-scores

*N* = 576; Only with awareness but no previous holding

```{r fig.height=5}
df_long_z %>% 
  filter(krybws01 == "Has heard of crypto currency",
         krybst01 == "Never held crypto currency")%>% 
plot_values("krybsz01")

```